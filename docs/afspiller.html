<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Podcast-afspiller</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div id="podcast-info" class="podcast-info"></div>
    </div>

<audio id="audio-player" controls style="width: 500px; position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); display: none;">
    Din browser understøtter ikke direkte afspilning af lydfiler
</audio>


    <script>
        async function loadPodcast() {
            try {
                const params = new URLSearchParams(window.location.search);
                const rssUrl = params.get('rss');
                if (!rssUrl) {
                    throw new Error('Ingen gyldig RSS');
                }
                const response = await fetch(rssUrl);
                const rssText = await response.text();
                const parser = new DOMParser();
                const rssDoc = parser.parseFromString(rssText, 'application/xml');
                const channel = rssDoc.querySelector('channel');

                const title = channel.querySelector('title').textContent;
                const description = channel.querySelector('description').textContent;
                const episodes = channel.querySelectorAll('item');

                let podcastInfo = `<h2>${title}</h2><p data-full-text="${description}" data-truncated-text="${truncateText(description, 200)}">${truncateText(description, 200)} <span class="toggle" onclick="toggleDescription(this)">▼</span>`;

                episodes.forEach((episode) => {
                    const episodeTitle = episode.querySelector('title').textContent;
                    const episodeDescription = episode.querySelector('description').textContent;
                    const episodePubDate = new Date(episode.querySelector('pubDate').textContent).toLocaleDateString();
                    const episodeEnclosure = episode.querySelector('enclosure');
                    const episodeLink = episodeEnclosure.getAttribute('url');

                    podcastInfo += `
                        <div class="episode" onclick="playEpisode('${episodeLink}')">
                            <h4 class="episode-title">${episodeTitle}</h4>
                            <p class="pub-date">(${episodePubDate})</p>
                            <p>${episodeDescription}</p>
                        </div>
                    `;
                });

                document.getElementById('podcast-info').innerHTML = podcastInfo;
            } catch (error) {
                document.getElementById('podcast-info').innerHTML = `<p>Error loading podcast data: ${error.message}</p>`;
                console.error('Error loading podcast data:', error);
            }
        }

        function playEpisode(episodeUrl) {
            const audioPlayer = document.getElementById('audio-player');
            audioPlayer.src = episodeUrl;
            audioPlayer.style.display = "block";
            audioPlayer.play();
        }

        function truncateText(text, maxLength) {
            if (text.length > maxLength) {
                return text.slice(0, maxLength) + '...';
            } else {
                return text;
            }
        }

        function toggleDescription(element) {
            const parent = element.parentElement;
            const fullText = parent.getAttribute('data-full-text');
            const truncatedText = parent.getAttribute('data-truncated-text');

            if (parent.classList.contains('expanded')) {
                parent.innerHTML = `${truncatedText} <span class="toggle" onclick="toggleDescription(this)">▼</span>`;
                parent.classList.remove('expanded');
            } else {
                parent.innerHTML = `${fullText} <span class="toggle" onclick="toggleDescription(this)">▲</span>`;
                parent.classList.add('expanded');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadPodcast();
        });
    </script>
</body>
</html>
